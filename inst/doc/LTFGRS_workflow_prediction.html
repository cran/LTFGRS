<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Emil M. Pedersen" />

<meta name="date" content="2025-08-28" />

<title>LTFGRS Workflow: Prepare Genetic Liability for Prediction</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<style type="text/css">.pagedtable {
overflow: auto;
padding-left: 8px;
padding-right: 8px;
}
.pagedtable-wrapper {
border: 1px solid #ccc;
border-radius: 4px;
margin-bottom: 10px;
}
.pagedtable table {
width: 100%;
max-width: 100%;
margin: 0;
}
.pagedtable th {
padding: 0 5px 0 5px;
border: none;
border-bottom: 2px solid #dddddd;
min-width: 45px;
}
.pagedtable-empty th {
display: none;
}
.pagedtable td {
padding: 0 4px 0 4px;
}
.pagedtable .even {
background-color: rgba(140, 140, 140, 0.1);
}
.pagedtable-padding-col {
display: none;
}
.pagedtable a {
-webkit-touch-callout: none;
-webkit-user-select: none;
-khtml-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.pagedtable-index-nav {
cursor: pointer;
padding: 0 5px 0 5px;
float: right;
border: 0;
}
.pagedtable-index-nav-disabled {
cursor: default;
text-decoration: none;
color: #999;
}
a.pagedtable-index-nav-disabled:hover {
text-decoration: none;
color: #999;
}
.pagedtable-indexes {
cursor: pointer;
float: right;
border: 0;
}
.pagedtable-index-current {
cursor: default;
text-decoration: none;
font-weight: bold;
color: #333;
border: 0;
}
a.pagedtable-index-current:hover {
text-decoration: none;
font-weight: bold;
color: #333;
}
.pagedtable-index {
width: 30px;
display: inline-block;
text-align: center;
border: 0;
}
.pagedtable-index-separator-left {
display: inline-block;
color: #333;
font-size: 9px;
padding: 0 0 0 0;
cursor: default;
}
.pagedtable-index-separator-right {
display: inline-block;
color: #333;
font-size: 9px;
padding: 0 4px 0 0;
cursor: default;
}
.pagedtable-footer {
padding-top: 4px;
padding-bottom: 5px;
}
.pagedtable-not-empty .pagedtable-footer {
border-top: 2px solid #dddddd;
}
.pagedtable-info {
overflow: hidden;
color: #999;
white-space: nowrap;
text-overflow: ellipsis;
}
.pagedtable-header-name {
overflow: hidden;
text-overflow: ellipsis;
}
.pagedtable-header-type {
color: #999;
font-weight: 400;
}
.pagedtable-na-cell {
font-style: italic;
opacity: 0.3;
}
</style>
<script>// Production steps of ECMA-262, Edition 5, 15.4.4.18
// Reference: http://es5.github.io/#x15.4.4.18
if (!Array.prototype.forEach) {

  Array.prototype.forEach = function(callback, thisArg) {

    var T, k;

    if (this === null) {
      throw new TypeError(' this is null or not defined');
    }

    // 1. Let O be the result of calling toObject() passing the
    // |this| value as the argument.
    var O = Object(this);

    // 2. Let lenValue be the result of calling the Get() internal
    // method of O with the argument "length".
    // 3. Let len be toUint32(lenValue).
    var len = O.length >>> 0;

    // 4. If isCallable(callback) is false, throw a TypeError exception.
    // See: http://es5.github.com/#x9.11
    if (typeof callback !== "function") {
      throw new TypeError(callback + ' is not a function');
    }

    // 5. If thisArg was supplied, let T be thisArg; else let
    // T be undefined.
    if (arguments.length > 1) {
      T = thisArg;
    }

    // 6. Let k be 0
    k = 0;

    // 7. Repeat, while k < len
    while (k < len) {

      var kValue;

      // a. Let Pk be ToString(k).
      //    This is implicit for LHS operands of the in operator
      // b. Let kPresent be the result of calling the HasProperty
      //    internal method of O with argument Pk.
      //    This step can be combined with c
      // c. If kPresent is true, then
      if (k in O) {

        // i. Let kValue be the result of calling the Get internal
        // method of O with argument Pk.
        kValue = O[k];

        // ii. Call the Call internal method of callback with T as
        // the this value and argument list containing kValue, k, and O.
        callback.call(T, kValue, k, O);
      }
      // d. Increase k by 1.
      k++;
    }
    // 8. return undefined
  };
}

// Production steps of ECMA-262, Edition 5, 15.4.4.19
// Reference: http://es5.github.io/#x15.4.4.19
if (!Array.prototype.map) {

  Array.prototype.map = function(callback, thisArg) {

    var T, A, k;

    if (this == null) {
      throw new TypeError(' this is null or not defined');
    }

    // 1. Let O be the result of calling ToObject passing the |this|
    //    value as the argument.
    var O = Object(this);

    // 2. Let lenValue be the result of calling the Get internal
    //    method of O with the argument "length".
    // 3. Let len be ToUint32(lenValue).
    var len = O.length >>> 0;

    // 4. If IsCallable(callback) is false, throw a TypeError exception.
    // See: http://es5.github.com/#x9.11
    if (typeof callback !== 'function') {
      throw new TypeError(callback + ' is not a function');
    }

    // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.
    if (arguments.length > 1) {
      T = thisArg;
    }

    // 6. Let A be a new array created as if by the expression new Array(len)
    //    where Array is the standard built-in constructor with that name and
    //    len is the value of len.
    A = new Array(len);

    // 7. Let k be 0
    k = 0;

    // 8. Repeat, while k < len
    while (k < len) {

      var kValue, mappedValue;

      // a. Let Pk be ToString(k).
      //   This is implicit for LHS operands of the in operator
      // b. Let kPresent be the result of calling the HasProperty internal
      //    method of O with argument Pk.
      //   This step can be combined with c
      // c. If kPresent is true, then
      if (k in O) {

        // i. Let kValue be the result of calling the Get internal
        //    method of O with argument Pk.
        kValue = O[k];

        // ii. Let mappedValue be the result of calling the Call internal
        //     method of callback with T as the this value and argument
        //     list containing kValue, k, and O.
        mappedValue = callback.call(T, kValue, k, O);

        // iii. Call the DefineOwnProperty internal method of A with arguments
        // Pk, Property Descriptor
        // { Value: mappedValue,
        //   Writable: true,
        //   Enumerable: true,
        //   Configurable: true },
        // and false.

        // In browsers that support Object.defineProperty, use the following:
        // Object.defineProperty(A, k, {
        //   value: mappedValue,
        //   writable: true,
        //   enumerable: true,
        //   configurable: true
        // });

        // For best browser support, use the following:
        A[k] = mappedValue;
      }
      // d. Increase k by 1.
      k++;
    }

    // 9. return A
    return A;
  };
}

var PagedTable = function (pagedTable) {
  var me = this;

  var source = function(pagedTable) {
    var sourceElems = [].slice.call(pagedTable.children).filter(function(e) {
      return e.hasAttribute("data-pagedtable-source");
    });

    if (sourceElems === null || sourceElems.length !== 1) {
      throw("A single data-pagedtable-source was not found");
    }

    return JSON.parse(sourceElems[0].innerHTML);
  }(pagedTable);

  var options = function(source) {
    var options = typeof(source.options) !== "undefined" &&
      source.options !== null ? source.options : {};

    var columns = typeof(options.columns) !== "undefined" ? options.columns : {};
    var rows = typeof(options.rows) !== "undefined" ? options.rows : {};

    var positiveIntOrNull = function(value) {
      return parseInt(value) >= 0 ? parseInt(value) : null;
    };

    return {
      pages: positiveIntOrNull(options.pages),
      rows: {
        min: positiveIntOrNull(rows.min),
        max: positiveIntOrNull(rows.max),
        total: positiveIntOrNull(rows.total)
      },
      columns: {
        min: positiveIntOrNull(columns.min),
        max: positiveIntOrNull(columns.max),
        total: positiveIntOrNull(columns.total)
      }
    };
  }(source);

  var Measurer = function() {

    // set some default initial values that will get adjusted in runtime
    me.measures = {
      padding: 12,
      character: 8,
      height: 15,
      defaults: true
    };

    me.calculate = function(measuresCell) {
      if (!me.measures.defaults)
        return;

      var measuresCellStyle = window.getComputedStyle(measuresCell, null);

      var newPadding = parsePadding(measuresCellStyle.paddingLeft) +
            parsePadding(measuresCellStyle.paddingRight);

      var sampleString = "ABCDEFGHIJ0123456789";
      var newCharacter = Math.ceil(measuresCell.clientWidth / sampleString.length);

      if (newPadding <= 0 || newCharacter <= 0)
        return;

      me.measures.padding = newPadding;
      me.measures.character = newCharacter;
      me.measures.height = measuresCell.clientHeight;
      me.measures.defaults = false;
    };

    return me;
  };

  var Page = function(data, options) {
    var me = this;

    var defaults = {
      max: 7,
      rows: 10
    };

    var totalPages = function() {
      return Math.ceil(data.length / me.rows);
    };

    me.number = 0;
    me.max = options.pages !== null ? options.pages : defaults.max;
    me.visible = me.max;
    me.rows = options.rows.min !== null ? options.rows.min : defaults.rows;
    me.total = totalPages();

    me.setRows = function(newRows) {
      me.rows = newRows;
      me.total = totalPages();
    };

    me.setPageNumber = function(newPageNumber) {
      if (newPageNumber < 0) newPageNumber = 0;
      if (newPageNumber >= me.total) newPageNumber = me.total - 1;

      me.number = newPageNumber;
    };

    me.setVisiblePages = function(visiblePages) {
      me.visible = Math.min(me.max, visiblePages);
      me.setPageNumber(me.number);
    };

    me.getVisiblePageRange = function() {
      var start = me.number - Math.max(Math.floor((me.visible - 1) / 2), 0);
      var end = me.number + Math.floor(me.visible / 2) + 1;
      var pageCount = me.total;

      if (start < 0) {
        var diffToStart = 0 - start;
        start += diffToStart;
        end += diffToStart;
      }

      if (end > pageCount) {
        var diffToEnd = end - pageCount;
        start -= diffToEnd;
        end -= diffToEnd;
      }

      start = start < 0 ? 0 : start;
      end = end >= pageCount ? pageCount : end;

      var first = false;
      var last = false;

      if (start > 0 && me.visible > 1) {
        start = start + 1;
        first = true;
      }

      if (end < pageCount && me.visible > 2) {
        end = end - 1;
        last = true;
      }

      return {
        first: first,
        start: start,
        end: end,
        last: last
      };
    };

    me.getRowStart = function() {
      var rowStart = page.number * page.rows;
      if (rowStart < 0)
        rowStart = 0;

      return rowStart;
    };

    me.getRowEnd = function() {
      var rowStart = me.getRowStart();
      return Math.min(rowStart + me.rows, data.length);
    };

    me.getPaddingRows = function() {
      var rowStart = me.getRowStart();
      var rowEnd = me.getRowEnd();
      return data.length > me.rows ? me.rows - (rowEnd - rowStart) : 0;
    };
  };

  var Columns = function(data, columns, options) {
    var me = this;

    me.defaults = {
      min: 5
    };

    me.number = 0;
    me.visible = 0;
    me.total = columns.length;
    me.subset = [];
    me.padding = 0;
    me.min = options.columns.min !== null ? options.columns.min : me.defaults.min;
    me.max = options.columns.max !== null ? options.columns.max : null;
    me.widths = {};

    var widthsLookAhead = Math.max(100, options.rows.min);
    var paddingColChars = 10;

    me.emptyNames = function() {
      columns.forEach(function(column) {
        if (columns.label !== null && columns.label !== "")
          return false;
      });

      return true;
    };

    var parsePadding = function(value) {
      return parseInt(value) >= 0 ? parseInt(value) : 0;
    };

    me.calculateWidths = function(measures) {
      columns.forEach(function(column) {
        var maxChars = Math.max(
          column.label.toString().length,
          column.type.toString().length
        );

        for (var idxRow = 0; idxRow < Math.min(widthsLookAhead, data.length); idxRow++) {
          maxChars = Math.max(maxChars, data[idxRow][column.name.toString()].length);
        }

        me.widths[column.name] = {
          // width in characters
          chars: maxChars,
          // width for the inner html columns
          inner: maxChars * measures.character,
          // width adding outer styles like padding
          outer: maxChars * measures.character + measures.padding
        };
      });
    };

    me.getWidth = function() {
      var widthOuter = 0;
      for (var idxCol = 0; idxCol < me.subset.length; idxCol++) {
        var columnName = me.subset[idxCol].name;
        widthOuter = widthOuter + me.widths[columnName].outer;
      }

      widthOuter = widthOuter + me.padding * paddingColChars * measurer.measures.character;

      if (me.hasMoreLeftColumns()) {
        widthOuter = widthOuter + columnNavigationWidthPX + measurer.measures.padding;
      }

      if (me.hasMoreRightColumns()) {
        widthOuter = widthOuter + columnNavigationWidthPX + measurer.measures.padding;
      }

      return widthOuter;
    };

    me.updateSlice = function() {
      if (me.number + me.visible >= me.total)
        me.number = me.total - me.visible;

      if (me.number < 0) me.number = 0;

      me.subset = columns.slice(me.number, Math.min(me.number + me.visible, me.total));

      me.subset = me.subset.map(function(column) {
        Object.keys(column).forEach(function(colKey) {
          column[colKey] = column[colKey] === null ? "" : column[colKey].toString();
        });

        column.width = null;
        return column;
      });
    };

    me.setVisibleColumns = function(columnNumber, newVisibleColumns, paddingCount) {
      me.number = columnNumber;
      me.visible = newVisibleColumns;
      me.padding = paddingCount;

      me.updateSlice();
    };

    me.incColumnNumber = function(increment) {
      me.number = me.number + increment;
    };

    me.setColumnNumber = function(newNumber) {
      me.number = newNumber;
    };

    me.setPaddingCount = function(newPadding) {
      me.padding = newPadding;
    };

    me.getPaddingCount = function() {
      return me.padding;
    };

    me.hasMoreLeftColumns = function() {
      return me.number > 0;
    };

    me.hasMoreRightColumns = function() {
      return me.number + me.visible < me.total;
    };

    me.updateSlice(0);
    return me;
  };

  var data = source.data;
  var page = new Page(data, options);
  var measurer = new Measurer(data, options);
  var columns = new Columns(data, source.columns, options);

  var table = null;
  var tableDiv = null;
  var header = null;
  var footer = null;
  var tbody = null;

  // Caches pagedTable.clientWidth, specially for webkit
  var cachedPagedTableClientWidth = null;

  var onChangeCallbacks = [];

  var clearSelection = function() {
    if(document.selection && document.selection.empty) {
      document.selection.empty();
    } else if(window.getSelection) {
      var sel = window.getSelection();
      sel.removeAllRanges();
    }
  };

  var columnNavigationWidthPX = 5;

  var renderColumnNavigation = function(increment, backwards) {
    var arrow = document.createElement("div");
    arrow.setAttribute("style",
      "border-top: " + columnNavigationWidthPX + "px solid transparent;" +
      "border-bottom: " + columnNavigationWidthPX + "px solid transparent;" +
      "border-" + (backwards ? "right" : "left") + ": " + columnNavigationWidthPX + "px solid;");

    var header = document.createElement("th");
    header.appendChild(arrow);
    header.setAttribute("style",
      "cursor: pointer;" +
      "vertical-align: middle;" +
      "min-width: " + columnNavigationWidthPX + "px;" +
      "width: " + columnNavigationWidthPX + "px;");

    header.onclick = function() {
      columns.incColumnNumber(backwards ? -1 : increment);

      me.animateColumns(backwards);
      renderFooter();

      clearSelection();
      triggerOnChange();
    };

    return header;
  };

  var maxColumnWidth = function(width) {
    var padding = 80;
    var columnMax = Math.max(cachedPagedTableClientWidth - padding, 0);

    return parseInt(width) > 0 ?
      Math.min(columnMax, parseInt(width)) + "px" :
      columnMax + "px";
  };

  var clearHeader = function() {
    var thead = pagedTable.querySelectorAll("thead")[0];
    thead.innerHTML = "";
  };

  var renderHeader = function(clear) {
    cachedPagedTableClientWidth = pagedTable.clientWidth;

    var fragment = document.createDocumentFragment();

    header = document.createElement("tr");
    fragment.appendChild(header);

    if (columns.number > 0)
      header.appendChild(renderColumnNavigation(-columns.visible, true));

    columns.subset = columns.subset.map(function(columnData) {
      var column = document.createElement("th");
      column.setAttribute("align", columnData.align);
      column.style.textAlign = columnData.align;

      column.style.maxWidth = maxColumnWidth(null);
      if (columnData.width) {
        column.style.minWidth =
          column.style.maxWidth = maxColumnWidth(columnData.width);
      }

      var columnName = document.createElement("div");
      columnName.setAttribute("class", "pagedtable-header-name");
      if (columnData.label === "") {
        columnName.innerHTML = "&nbsp;";
      }
      else {
        columnName.appendChild(document.createTextNode(columnData.label));
      }
      column.appendChild(columnName);

      var columnType = document.createElement("div");
      columnType.setAttribute("class", "pagedtable-header-type");
      if (columnData.type === "") {
        columnType.innerHTML = "&nbsp;";
      }
      else {
        columnType.appendChild(document.createTextNode("<" + columnData.type + ">"));
      }
      column.appendChild(columnType);

      header.appendChild(column);

      columnData.element = column;

      return columnData;
    });

    for (var idx = 0; idx < columns.getPaddingCount(); idx++) {
      var paddingCol = document.createElement("th");
      paddingCol.setAttribute("class", "pagedtable-padding-col");
      header.appendChild(paddingCol);
    }

    if (columns.number + columns.visible < columns.total)
      header.appendChild(renderColumnNavigation(columns.visible, false));

    if (typeof(clear) == "undefined" || clear) clearHeader();
    var thead = pagedTable.querySelectorAll("thead")[0];
    thead.appendChild(fragment);
  };

  me.animateColumns = function(backwards) {
    var thead = pagedTable.querySelectorAll("thead")[0];

    var headerOld = thead.querySelectorAll("tr")[0];
    var tbodyOld = table.querySelectorAll("tbody")[0];

    me.fitColumns(backwards);

    renderHeader(false);

    header.style.opacity = "0";
    header.style.transform = backwards ? "translateX(-30px)" : "translateX(30px)";
    header.style.transition = "transform 200ms linear, opacity 200ms";
    header.style.transitionDelay = "0";

    renderBody(false);

    if (headerOld) {
      headerOld.style.position = "absolute";
      headerOld.style.transform = "translateX(0px)";
      headerOld.style.opacity = "1";
      headerOld.style.transition = "transform 100ms linear, opacity 100ms";
      headerOld.setAttribute("class", "pagedtable-remove-head");
      if (headerOld.style.transitionEnd) {
        headerOld.addEventListener("transitionend", function() {
          var headerOldByClass = thead.querySelector(".pagedtable-remove-head");
          if (headerOldByClass) thead.removeChild(headerOldByClass);
        });
      }
      else {
        thead.removeChild(headerOld);
      }
    }

    if (tbodyOld) table.removeChild(tbodyOld);

    tbody.style.opacity = "0";
    tbody.style.transition = "transform 200ms linear, opacity 200ms";
    tbody.style.transitionDelay = "0ms";

    // force relayout
    window.getComputedStyle(header).opacity;
    window.getComputedStyle(tbody).opacity;

    if (headerOld) {
      headerOld.style.transform = backwards ? "translateX(20px)" : "translateX(-30px)";
      headerOld.style.opacity = "0";
    }

    header.style.transform = "translateX(0px)";
    header.style.opacity = "1";

    tbody.style.opacity = "1";
  }

  me.onChange = function(callback) {
    onChangeCallbacks.push(callback);
  };

  var triggerOnChange = function() {
    onChangeCallbacks.forEach(function(onChange) {
      onChange();
    });
  };

  var clearBody = function() {
    if (tbody) {
      table.removeChild(tbody);
      tbody = null;
    }
  };

  var renderBody = function(clear) {
    cachedPagedTableClientWidth = pagedTable.clientWidth

    var fragment = document.createDocumentFragment();

    var pageData = data.slice(page.getRowStart(), page.getRowEnd());

    pageData.forEach(function(dataRow, idxRow) {
      var htmlRow = document.createElement("tr");
      htmlRow.setAttribute("class", (idxRow % 2 !==0) ? "even" : "odd");

      if (columns.hasMoreLeftColumns())
        htmlRow.appendChild(document.createElement("td"));

      columns.subset.forEach(function(columnData) {
        var cellName = columnData.name;
        var dataCell = dataRow[cellName];
        var htmlCell = document.createElement("td");

        if (dataCell === "NA") htmlCell.setAttribute("class", "pagedtable-na-cell");
        if (dataCell === "__NA__") dataCell = "NA";

        var cellText = document.createTextNode(dataCell);
        htmlCell.appendChild(cellText);
        if (dataCell.length > 50) {
          htmlCell.setAttribute("title", dataCell);
        }
        htmlCell.setAttribute("align", columnData.align);
        htmlCell.style.textAlign = columnData.align;
        htmlCell.style.maxWidth = maxColumnWidth(null);
        if (columnData.width) {
          htmlCell.style.minWidth = htmlCell.style.maxWidth = maxColumnWidth(columnData.width);
        }
        htmlRow.appendChild(htmlCell);
      });

      for (var idx = 0; idx < columns.getPaddingCount(); idx++) {
        var paddingCol = document.createElement("td");
        paddingCol.setAttribute("class", "pagedtable-padding-col");
        htmlRow.appendChild(paddingCol);
      }

      if (columns.hasMoreRightColumns())
        htmlRow.appendChild(document.createElement("td"));

      fragment.appendChild(htmlRow);
    });

    for (var idxPadding = 0; idxPadding < page.getPaddingRows(); idxPadding++) {
      var paddingRow = document.createElement("tr");

      var paddingCellRow = document.createElement("td");
      paddingCellRow.innerHTML = "&nbsp;";
      paddingCellRow.setAttribute("colspan", "100%");
      paddingRow.appendChild(paddingCellRow);

      fragment.appendChild(paddingRow);
    }

    if (typeof(clear) == "undefined" || clear) clearBody();
    tbody = document.createElement("tbody");
    tbody.appendChild(fragment);

    table.appendChild(tbody);
  };

  var getLabelInfo = function() {
    var pageStart = page.getRowStart();
    var pageEnd = page.getRowEnd();
    var totalRows = data.length;

    var totalRowsLabel = options.rows.total ? options.rows.total : totalRows;
    var totalRowsLabelFormat = totalRowsLabel.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,');

    var infoText = (pageStart + 1) + "-" + pageEnd + " of " + totalRowsLabelFormat + " rows";
    if (totalRows < page.rows) {
      infoText = totalRowsLabel + " row" + (totalRows != 1 ? "s" : "");
    }
    if (columns.total > columns.visible) {
      var totalColumnsLabel = options.columns.total ? options.columns.total : columns.total;

      infoText = infoText + " | " + (columns.number + 1) + "-" +
        (Math.min(columns.number + columns.visible, columns.total)) +
        " of " + totalColumnsLabel + " columns";
    }

    return infoText;
  };

  var clearFooter = function() {
    footer = pagedTable.querySelectorAll("div.pagedtable-footer")[0];
    footer.innerHTML = "";

    return footer;
  };

  var createPageLink = function(idxPage) {
    var pageLink = document.createElement("a");
    pageLinkClass = idxPage === page.number ? "pagedtable-index pagedtable-index-current" : "pagedtable-index";
    pageLink.setAttribute("class", pageLinkClass);
    pageLink.setAttribute("data-page-index", idxPage);
    pageLink.onclick = function() {
      page.setPageNumber(parseInt(this.getAttribute("data-page-index")));
      renderBody();
      renderFooter();

      triggerOnChange();
    };

    pageLink.appendChild(document.createTextNode(idxPage + 1));

    return pageLink;
  }

  var renderFooter = function() {
    footer = clearFooter();

    var next = document.createElement("a");
    next.appendChild(document.createTextNode("Next"));
    next.onclick = function() {
      page.setPageNumber(page.number + 1);
      renderBody();
      renderFooter();

      triggerOnChange();
    };
    if (data.length > page.rows) footer.appendChild(next);

    var pageNumbers = document.createElement("div");
    pageNumbers.setAttribute("class", "pagedtable-indexes");

    var pageRange = page.getVisiblePageRange();

    if (pageRange.first) {
      var pageLink = createPageLink(0);
      pageNumbers.appendChild(pageLink);

      var pageSeparator = document.createElement("div");
      pageSeparator.setAttribute("class", "pagedtable-index-separator-left");
      pageSeparator.appendChild(document.createTextNode("..."))
      pageNumbers.appendChild(pageSeparator);
    }

    for (var idxPage = pageRange.start; idxPage < pageRange.end; idxPage++) {
      var pageLink = createPageLink(idxPage);

      pageNumbers.appendChild(pageLink);
    }

    if (pageRange.last) {
      var pageSeparator = document.createElement("div");
      pageSeparator.setAttribute("class", "pagedtable-index-separator-right");
      pageSeparator.appendChild(document.createTextNode("..."))
      pageNumbers.appendChild(pageSeparator);

      var pageLink = createPageLink(page.total - 1);
      pageNumbers.appendChild(pageLink);
    }

    if (data.length > page.rows) footer.appendChild(pageNumbers);

    var previous = document.createElement("a");
    previous.appendChild(document.createTextNode("Previous"));
    previous.onclick = function() {
      page.setPageNumber(page.number - 1);
      renderBody();
      renderFooter();

      triggerOnChange();
    };
    if (data.length > page.rows) footer.appendChild(previous);

    var infoLabel = document.createElement("div");
    infoLabel.setAttribute("class", "pagedtable-info");
    infoLabel.setAttribute("title", getLabelInfo());
    infoLabel.appendChild(document.createTextNode(getLabelInfo()));
    footer.appendChild(infoLabel);

    var enabledClass = "pagedtable-index-nav";
    var disabledClass = "pagedtable-index-nav pagedtable-index-nav-disabled";
    previous.setAttribute("class", page.number <= 0 ? disabledClass : enabledClass);
    next.setAttribute("class", (page.number + 1) * page.rows >= data.length ? disabledClass : enabledClass);
  };

  var measuresCell = null;

  var renderMeasures = function() {
    var measuresTable = document.createElement("table");
    measuresTable.style.visibility = "hidden";
    measuresTable.style.position = "absolute";
    measuresTable.style.whiteSpace = "nowrap";
    measuresTable.style.height = "auto";
    measuresTable.style.width = "auto";

    var measuresRow = document.createElement("tr");
    measuresTable.appendChild(measuresRow);

    measuresCell = document.createElement("td");
    var sampleString = "ABCDEFGHIJ0123456789";
    measuresCell.appendChild(document.createTextNode(sampleString));

    measuresRow.appendChild(measuresCell);

    tableDiv.appendChild(measuresTable);
  }

  me.init = function() {
    tableDiv = document.createElement("div");
    pagedTable.appendChild(tableDiv);
    var pagedTableClass = data.length > 0 ?
      "pagedtable pagedtable-not-empty" :
      "pagedtable pagedtable-empty";

    if (columns.total == 0 || (columns.emptyNames() && data.length == 0)) {
      pagedTableClass = pagedTableClass + " pagedtable-empty-columns";
    }

    tableDiv.setAttribute("class", pagedTableClass);

    renderMeasures();
    measurer.calculate(measuresCell);
    columns.calculateWidths(measurer.measures);

    table = document.createElement("table");
    table.setAttribute("cellspacing", "0");
    table.setAttribute("class", "table table-condensed");
    tableDiv.appendChild(table);

    table.appendChild(document.createElement("thead"));

    var footerDiv = document.createElement("div");
    footerDiv.setAttribute("class", "pagedtable-footer");
    tableDiv.appendChild(footerDiv);

    // if the host has not yet provided horizontal space, render hidden
    if (tableDiv.clientWidth <= 0) {
      tableDiv.style.opacity = "0";
    }

    me.render();

    // retry seizing columns later if the host has not provided space
    function retryFit() {
      if (tableDiv.clientWidth <= 0) {
        setTimeout(retryFit, 100);
      } else {
        me.render();
        triggerOnChange();
      }
    }
    if (tableDiv.clientWidth <= 0) {
      retryFit();
    }
  };

  var registerWidths = function() {
    columns.subset = columns.subset.map(function(column) {
      column.width = columns.widths[column.name].inner;
      return column;
    });
  };

  var parsePadding = function(value) {
    return parseInt(value) >= 0 ? parseInt(value) : 0;
  };

  me.fixedHeight = function() {
    return options.rows.max != null;
  }

  me.fitRows = function() {
    if (me.fixedHeight())
      return;

    measurer.calculate(measuresCell);

    var rows = options.rows.min !== null ? options.rows.min : 0;
    var headerHeight = header !== null && header.offsetHeight > 0 ? header.offsetHeight : 0;
    var footerHeight = footer !== null && footer.offsetHeight > 0 ? footer.offsetHeight : 0;

    if (pagedTable.offsetHeight > 0) {
      var availableHeight = pagedTable.offsetHeight - headerHeight - footerHeight;
      rows = Math.floor((availableHeight) / measurer.measures.height);
    }

    rows = options.rows.min !== null ? Math.max(options.rows.min, rows) : rows;

    page.setRows(rows);
  }

  // The goal of this function is to add as many columns as possible
  // starting from left-to-right, when the right most limit is reached
  // it tries to add columns from the left as well.
  //
  // When startBackwards is true columns are added from right-to-left
  me.fitColumns = function(startBackwards) {
    measurer.calculate(measuresCell);
    columns.calculateWidths(measurer.measures);

    if (tableDiv.clientWidth > 0) {
      tableDiv.style.opacity = 1;
    }

    var visibleColumns = tableDiv.clientWidth <= 0 ? Math.max(columns.min, 1) : 1;
    var columnNumber = columns.number;
    var paddingCount = 0;

    // track a list of added columns as we build the visible ones to allow us
    // to remove columns when they don't fit anymore.
    var columnHistory = [];

    var lastTableHeight = 0;
    var backwards = startBackwards;

    var tableDivStyle = window.getComputedStyle(tableDiv, null);
    var tableDivPadding = parsePadding(tableDivStyle.paddingLeft) +
      parsePadding(tableDivStyle.paddingRight);

    var addPaddingCol = false;
    var currentWidth = 0;

    while (true) {
      columns.setVisibleColumns(columnNumber, visibleColumns, paddingCount);
      currentWidth = columns.getWidth();

      if (tableDiv.clientWidth - tableDivPadding < currentWidth) {
        break;
      }

      columnHistory.push({
        columnNumber: columnNumber,
        visibleColumns: visibleColumns,
        paddingCount: paddingCount
      });

      if (columnHistory.length > 100) {
        console.error("More than 100 tries to fit columns, aborting");
        break;
      }

      if (columns.max !== null &&
        columns.visible + columns.getPaddingCount() >= columns.max) {
        break;
      }

      // if we run out of right-columns
      if (!backwards && columnNumber + columns.visible >= columns.total) {
        // if we started adding right-columns, try adding left-columns
        if (!startBackwards && columnNumber > 0) {
          backwards = true;
        }
        else if (columns.min === null || visibleColumns + columns.getPaddingCount() >= columns.min) {
          break;
        }
        else {
          paddingCount = paddingCount + 1;
        }
      }

      // if we run out of left-columns
      if (backwards && columnNumber == 0) {
        // if we started adding left-columns, try adding right-columns
        if (startBackwards && columnNumber + columns.visible < columns.total) {
          backwards = false;
        }
        else if (columns.min === null || visibleColumns + columns.getPaddingCount() >= columns.min) {
          break;
        }
        else {
          paddingCount = paddingCount + 1;
        }
      }

      // when moving backwards try fitting left columns first
      if (backwards && columnNumber > 0) {
        columnNumber = columnNumber - 1;
      }

      if (columnNumber + visibleColumns < columns.total) {
        visibleColumns = visibleColumns + 1;
      }
    }

    var lastRenderableColumn = {
        columnNumber: columnNumber,
        visibleColumns: visibleColumns,
        paddingCount: paddingCount
    };

    if (columnHistory.length > 0) {
      lastRenderableColumn = columnHistory[columnHistory.length - 1];
    }

    columns.setVisibleColumns(
      lastRenderableColumn.columnNumber,
      lastRenderableColumn.visibleColumns,
      lastRenderableColumn.paddingCount);

    if (pagedTable.offsetWidth > 0) {
      page.setVisiblePages(Math.max(Math.ceil(1.0 * (pagedTable.offsetWidth - 250) / 40), 2));
    }

    registerWidths();
  };

  me.fit = function(startBackwards) {
    me.fitRows();
    me.fitColumns(startBackwards);
  }

  me.render = function() {
    me.fitColumns(false);

    // render header/footer to measure height accurately
    renderHeader();
    renderFooter();

    me.fitRows();
    renderBody();

    // re-render footer to match new rows
    renderFooter();
  }

  var resizeLastWidth = -1;
  var resizeLastHeight = -1;
  var resizeNewWidth = -1;
  var resizeNewHeight = -1;
  var resizePending = false;

  me.resize = function(newWidth, newHeight) {

    function resizeDelayed() {
      resizePending = false;

      if (
        (resizeNewWidth !== resizeLastWidth) ||
        (!me.fixedHeight() && resizeNewHeight !== resizeLastHeight)
      ) {
        resizeLastWidth = resizeNewWidth;
        resizeLastHeight = resizeNewHeight;

        setTimeout(resizeDelayed, 200);
        resizePending = true;
      } else {
        me.render();
        triggerOnChange();

        resizeLastWidth = -1;
        resizeLastHeight = -1;
      }
    }

    resizeNewWidth = newWidth;
    resizeNewHeight = newHeight;

    if (!resizePending) resizeDelayed();
  };
};

var PagedTableDoc;
(function (PagedTableDoc) {
  var allPagedTables = [];

  PagedTableDoc.initAll = function() {
    allPagedTables = [];

    var pagedTables = [].slice.call(document.querySelectorAll('[data-pagedtable="false"],[data-pagedtable=""]'));
    pagedTables.forEach(function(pagedTable, idx) {
      pagedTable.setAttribute("data-pagedtable", "true");
      pagedTable.setAttribute("pagedtable-page", 0);
      pagedTable.setAttribute("class", "pagedtable-wrapper");

      var pagedTableInstance = new PagedTable(pagedTable);
      pagedTableInstance.init();

      allPagedTables.push(pagedTableInstance);
    });
  };

  PagedTableDoc.resizeAll = function() {
    allPagedTables.forEach(function(pagedTable) {
      pagedTable.render();
    });
  };

  window.addEventListener("resize", PagedTableDoc.resizeAll);

  return PagedTableDoc;
})(PagedTableDoc || (PagedTableDoc = {}));

window.onload = function() {
  PagedTableDoc.initAll();
};
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">LTFGRS Workflow: Prepare Genetic Liability
for Prediction</h1>
<h4 class="author">Emil M. Pedersen</h4>
<h4 class="date">2025-08-28</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(LTFGRS)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(rmarkdown)</span></code></pre></div>
<p><strong><em>All data is simulated and is purely for demonstration
purposes - This includes the CIP.</em></strong></p>
<p>This vignette is intended to give users of the package an overview of
how to use the different functions of the package and how they are
intended to work together. The liability-based predictors can be used
for prediction or as a refined outcome in a GWAS. This vignette focuses
on preparing for prediction, as this purpose requires the user to
consider additional steps, such as censoring of future events and
masking the outcome of the target individual. The vignette will cover
the following steps:</p>
<ul>
<li>Simulate mock trio, phenotype, and CIP data</li>
<li>Convert mock trio and phenotype data into a format suitable for
estimate_liability()
<ul>
<li>Automatic identification of n-degree relatives</li>
<li>Censoring of future events on a family basis</li>
<li>Assign thresholds on censored families</li>
<li>Assign thresholds to family graphs</li>
</ul></li>
<li>Estimate the liability-based predictors using estimate_liability()
<ul>
<li>Both Gibbs and PA based estimators will be covered</li>
</ul></li>
</ul>
<div id="simulate-mock-trio-phenotype-and-cip-data" class="section level2">
<h2>Simulate mock trio, phenotype, and CIP data</h2>
<p>We will set some population parameters for the simulation. The
parameters are as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># population parameters and seed</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">555</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>h2 <span class="ot">=</span> .<span class="dv">5</span> <span class="co"># heritability</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>K <span class="ot">=</span> .<span class="dv">3</span> <span class="co"># population prevalence</span></span></code></pre></div>
<div id="cumulative-incidence-proportions-cip" class="section level3">
<h3>Cumulative incidence proportions (CIP)</h3>
<p>One of the key required input variables of LTFGRS is the population
representative stratified cumulative incidence proportions (CIP) data.
LTFGRS is able to utilise the population representative stratified CIPs
to personalise thresholds for the liability-based predictors. The CIPs
are typically obtained from large population registers or other sources
that allow for population representative estimates. Here, we simulate a
format similar to how stratified CIPs may be stored. We assume the CIPs
have been stratified by sex and birth year. The population
representative stratified CIPs has the interpretation of being the
proportion of individuals born in a given year and sex that has been
diagnosed with the outcome of interest by age <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># assuming we have been provided a CIP object of the following style:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>CIP <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="fu">list</span>(<span class="at">age =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                       <span class="at">birth_year =</span> <span class="dv">1900</span><span class="sc">:</span><span class="dv">2024</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                       <span class="at">sex =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cip =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>() <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span><span class="fu">n</span>() <span class="sc">*</span> K) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 25,000 × 4</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;      age birth_year   sex   cip</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;  1     1       1900     0 0    </span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt;  2     2       1900     0 0.003</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;  3     3       1900     0 0.006</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt;  4     4       1900     0 0.009</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;  5     5       1900     0 0.012</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;  6     6       1900     0 0.015</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt;  7     7       1900     0 0.018</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt;  8     8       1900     0 0.021</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt;  9     9       1900     0 0.024</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; 10    10       1900     0 0.027</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 24,990 more rows</span></span></code></pre></div>
</div>
<div id="trio-information" class="section level3">
<h3>Trio information</h3>
<p>The trio information presented here is a manually constructed to
resemble a typical way the trio data may be stored. The names are chosen
such that they resemble the relationship to the proband. This means
there are simple names such as “dad”, “mom”, or “sib”. There are also
more complex names such as “pgf” for maternal grand father, “muncle” for
maternal uncle”, “hsmcousin” for half-sibiling maternal cousin, etc. The
suffixes “H” and “W” mean husband and wife, respectively.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># hand curated trio information, taken from LTFHPlus vignette:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># https://emilmip.github.io/LTFHPlus/articles/FromTrioToFamilies.html</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>family <span class="ot">=</span> <span class="fu">tribble</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>momcol, <span class="sc">~</span>dadcol,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="st">&quot;pid&quot;</span>, <span class="st">&quot;mom&quot;</span>, <span class="st">&quot;dad&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="st">&quot;sib&quot;</span>, <span class="st">&quot;mom&quot;</span>, <span class="st">&quot;dad&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="st">&quot;mhs&quot;</span>, <span class="st">&quot;mom&quot;</span>, <span class="st">&quot;dad2&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="st">&quot;phs&quot;</span>, <span class="st">&quot;mom2&quot;</span>, <span class="st">&quot;dad&quot;</span>,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="st">&quot;mom&quot;</span>, <span class="st">&quot;mgm&quot;</span>, <span class="st">&quot;mgf&quot;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="st">&quot;dad&quot;</span>, <span class="st">&quot;pgm&quot;</span>, <span class="st">&quot;pgf&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="st">&quot;dad2&quot;</span>, <span class="st">&quot;pgm2&quot;</span>, <span class="st">&quot;pgf2&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="st">&quot;paunt&quot;</span>, <span class="st">&quot;pgm&quot;</span>, <span class="st">&quot;pgf&quot;</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="st">&quot;pacousin&quot;</span>, <span class="st">&quot;paunt&quot;</span>, <span class="st">&quot;pauntH&quot;</span>,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="st">&quot;hspaunt&quot;</span>, <span class="st">&quot;pgm&quot;</span>, <span class="st">&quot;newpgf&quot;</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="st">&quot;hspacousin&quot;</span>, <span class="st">&quot;hspaunt&quot;</span>, <span class="st">&quot;hspauntH&quot;</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="st">&quot;puncle&quot;</span>, <span class="st">&quot;pgm&quot;</span>, <span class="st">&quot;pgf&quot;</span>,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="st">&quot;pucousin&quot;</span>, <span class="st">&quot;puncleW&quot;</span>, <span class="st">&quot;puncle&quot;</span>,</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  <span class="st">&quot;maunt&quot;</span>, <span class="st">&quot;mgm&quot;</span>, <span class="st">&quot;mgf&quot;</span>,</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  <span class="st">&quot;macousin&quot;</span>, <span class="st">&quot;maunt&quot;</span>, <span class="st">&quot;mauntH&quot;</span>,</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  <span class="st">&quot;hsmuncle&quot;</span>, <span class="st">&quot;newmgm&quot;</span>, <span class="st">&quot;mgf&quot;</span>,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  <span class="st">&quot;hsmucousin&quot;</span>, <span class="st">&quot;hsmuncleW&quot;</span>, <span class="st">&quot;hsmuncle&quot;</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="phenotype-data" class="section level3">
<h3>Phenotype data</h3>
<p>We will simulate a liability based on the family structure defined
above to assign a case-control outcome to each individual. Then other
covariates such as sex and age are randomly assigned. To get the
case-control status, we first generate a (population) graph, calculate a
kinship matrix based on the heritability and kinship coefficient, and
finally, draw liabilities from a multivariate normal with the calculated
kinship matrix as covariance matrix.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># creating a graph for the family</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>graph <span class="ot">=</span> <span class="fu">prepare_graph</span>(<span class="at">.tbl =</span> family, <span class="at">icol =</span> <span class="st">&quot;id&quot;</span>, <span class="at">mcol =</span> <span class="st">&quot;momcol&quot;</span>, <span class="at">fcol =</span> <span class="st">&quot;dadcol&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># calculating the kinship matrix based on the graph</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>cov_mat <span class="ot">=</span> <span class="fu">get_covmat</span>(<span class="at">fam_graph =</span> graph, <span class="at">h2 =</span> h2, <span class="at">index_id =</span> <span class="st">&quot;pid&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># creating a phenotype for the family</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>liabs <span class="ot">=</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(cov_mat)), <span class="at">Sigma =</span> cov_mat)</span></code></pre></div>
<p>Next, we will create the mock phenotype data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># these values are simulated only for illustrative purposes and not to make sense(!)</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>pheno <span class="ot">=</span> <span class="fu">tibble</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">names</span>(liabs),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">status =</span> liabs <span class="sc">&gt;</span> <span class="fu">qnorm</span>(K, <span class="at">lower.tail =</span> F),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="co"># no consideration for generation etc in sex, fdato or birth_year:</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="fu">length</span>(liabs), <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="at">fdato =</span> <span class="fu">dmy</span>(<span class="fu">paste0</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="fu">length</span>(liabs), <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="st">&quot;/&quot;</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="fu">length</span>(liabs), <span class="at">replace =</span> T), <span class="st">&quot;/&quot;</span>, <span class="fu">sample</span>(<span class="dv">1940</span><span class="sc">:</span><span class="dv">2000</span>, <span class="fu">length</span>(liabs), <span class="at">replace =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">birth_year =</span> <span class="fu">year</span>(fdato),</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="co"># age of onset only after fdato</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="at">adhd =</span> purrr<span class="sc">::</span><span class="fu">map2_chr</span>(<span class="at">.x =</span> status, <span class="at">.y =</span> birth_year,</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>      <span class="sc">~</span> <span class="cf">if</span>(.x) <span class="fu">paste0</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">1</span>), <span class="st">&quot;/&quot;</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span>), <span class="st">&quot;/&quot;</span>, <span class="fu">sample</span>((.y <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">2010</span>, <span class="dv">1</span>)) <span class="cf">else</span> <span class="cn">NA</span>),</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="co"># end of follow up assigned here</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  <span class="at">indiv_eof =</span> <span class="fu">dmy</span>(<span class="st">&quot;31/12/2010&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># blanket time stop, meant to simulate end of registers</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="co"># converting to date format</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    <span class="at">adhd =</span> <span class="fu">dmy</span>(adhd),</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    <span class="co"># eof either blanket time stop or event date</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    <span class="at">indiv_eof =</span> <span class="fu">pmin</span>(indiv_eof, adhd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">!=</span> <span class="st">&quot;pid_g&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># remove the genetic liability of the proband</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="co"># status is not required here. Only used it to generate the age of diagnosis.</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>status) </span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="fu">paged_table</span>(pheno)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["sex"],"name":[2],"type":["int"],"align":["right"]},{"label":["fdato"],"name":[3],"type":["date"],"align":["right"]},{"label":["birth_year"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["adhd"],"name":[5],"type":["date"],"align":["right"]},{"label":["indiv_eof"],"name":[6],"type":["date"],"align":["right"]}],"data":[{"1":"dad","2":"0","3":"1957-09-16","4":"1957","5":"<NA>","6":"2010-12-31"},{"1":"mom","2":"0","3":"1957-09-17","4":"1957","5":"2009-11-08","6":"2009-11-08"},{"1":"dad2","2":"1","3":"2000-01-27","4":"2000","5":"<NA>","6":"2010-12-31"},{"1":"mom2","2":"1","3":"1978-08-17","4":"1978","5":"<NA>","6":"2010-12-31"},{"1":"mgf","2":"1","3":"1993-11-04","4":"1993","5":"<NA>","6":"2010-12-31"},{"1":"mgm","2":"1","3":"1953-03-23","4":"1953","5":"<NA>","6":"2010-12-31"},{"1":"pgf","2":"1","3":"2000-06-10","4":"2000","5":"<NA>","6":"2010-12-31"},{"1":"pgm","2":"1","3":"1998-09-13","4":"1998","5":"2002-07-12","6":"2002-07-12"},{"1":"pgf2","2":"1","3":"1977-12-11","4":"1977","5":"2005-06-11","6":"2005-06-11"},{"1":"pgm2","2":"0","3":"1994-11-16","4":"1994","5":"<NA>","6":"2010-12-31"},{"1":"pauntH","2":"1","3":"1997-11-05","4":"1997","5":"<NA>","6":"2010-12-31"},{"1":"paunt","2":"0","3":"1982-03-24","4":"1982","5":"<NA>","6":"2010-12-31"},{"1":"newpgf","2":"1","3":"1976-05-22","4":"1976","5":"<NA>","6":"2010-12-31"},{"1":"hspauntH","2":"0","3":"1998-05-13","4":"1998","5":"2010-09-11","6":"2010-09-11"},{"1":"hspaunt","2":"0","3":"1973-12-09","4":"1973","5":"1996-09-03","6":"1996-09-03"},{"1":"puncle","2":"0","3":"1991-02-13","4":"1991","5":"<NA>","6":"2010-12-31"},{"1":"puncleW","2":"1","3":"1997-09-16","4":"1997","5":"<NA>","6":"2010-12-31"},{"1":"mauntH","2":"0","3":"1995-10-10","4":"1995","5":"<NA>","6":"2010-12-31"},{"1":"maunt","2":"0","3":"1956-10-04","4":"1956","5":"<NA>","6":"2010-12-31"},{"1":"newmgm","2":"0","3":"1945-06-17","4":"1945","5":"1970-10-02","6":"1970-10-02"},{"1":"hsmuncle","2":"0","3":"1948-08-08","4":"1948","5":"2000-04-21","6":"2000-04-21"},{"1":"hsmuncleW","2":"0","3":"1961-04-17","4":"1961","5":"1972-07-03","6":"1972-07-03"},{"1":"sib","2":"1","3":"1969-11-11","4":"1969","5":"<NA>","6":"2010-12-31"},{"1":"pid","2":"1","3":"1958-10-17","4":"1958","5":"<NA>","6":"2010-12-31"},{"1":"mhs","2":"0","3":"1958-11-21","4":"1958","5":"1991-03-02","6":"1991-03-02"},{"1":"phs","2":"0","3":"1987-06-01","4":"1987","5":"<NA>","6":"2010-12-31"},{"1":"pacousin","2":"0","3":"1984-02-23","4":"1984","5":"<NA>","6":"2010-12-31"},{"1":"hspacousin","2":"1","3":"1975-11-18","4":"1975","5":"1987-09-18","6":"1987-09-18"},{"1":"pucousin","2":"1","3":"1995-03-01","4":"1995","5":"<NA>","6":"2010-12-31"},{"1":"macousin","2":"1","3":"1949-06-16","4":"1949","5":"<NA>","6":"2010-12-31"},{"1":"hsmucousin","2":"0","3":"1996-05-03","4":"1996","5":"2006-10-10","6":"2006-10-10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The mock phenotype data is intended to resemble a format that can
typically be derived from most register or bio bank phenotypes where the
age of diagnosis is available. Columns of interest are:</p>
<ul>
<li><code>fdato</code>: the birth date of the individual</li>
<li><code>birth_year</code>: the birth year of the individual</li>
<li><code>adhd</code>: the outcome of interest,</li>
<li><code>indiv_eof</code>: the personalised end of follow up for a
given individual. it may be different for each individual due to any
number of censoring or competing events.</li>
</ul>
</div>
</div>
<div id="preparing-for-estimate_liability" class="section level2">
<h2>Preparing for estimate_liability()</h2>
<p>In a real world scenario, we will not have access to all of the
information used above. We will assume that the objects
<code>CIP</code>, <code>family</code>, and <code>pheno</code> are the
only information available to the user. These objects hold information
that can often be extracted from population registers or bio banks.</p>
<ul>
<li><code>CIP</code>: The <code>CIP</code> object carry information
about the prevalence of the outcome of interest in the population and
therefore also on how each participant fits into the population
distribution.</li>
<li><code>family</code>: The <code>family</code> object holds the trio
information, i.e. information about the family structure and how each
individual is related to each other. In a real world scenario this
object may contains millions of unique individuals.</li>
<li><code>pheno</code>: The <code>pheno</code> object holds phenotypic
information on each individual present in the trio information.</li>
</ul>
<div id="population-graph" class="section level3">
<h3>Population graph</h3>
<p>With the <code>family</code> object, which holds the trio
information, we can construct a population graph. The population graph
holds all familial connects identified in the trio information and will
form the basis of how families are identified. In real-world
applications, the population graph may contain millions of individuals.
To illustrate all the required steps, we will recalculate the population
graph, but add sex as a node attribute.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>graph <span class="ot">=</span> <span class="fu">prepare_graph</span>(<span class="at">.tbl =</span> family, </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                      <span class="at">icol =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                      <span class="at">mcol =</span> <span class="st">&quot;momcol&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                      <span class="at">fcol =</span> <span class="st">&quot;dadcol&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>                      <span class="at">node_attributes =</span> <span class="fu">select</span>(pheno, id, sex))</span></code></pre></div>
</div>
<div id="automatic-identification-of-n-degree-relatives" class="section level3">
<h3>Automatic identification of n-degree relatives</h3>
<p>When we want to calculate a family genetic risk score, we need to
create a pedigree based on the proband and relations should be relative
to the proband. We are interested in identifying all family members up
to some degree of relatedness, <span class="math inline">\(n\)</span>,
without having to manually find all of these family members. Manually
identifying family members up to degree <span class="math inline">\(4\)</span> is both time consuming and error prone.
We have implemented an automatic detection of family members that
utilise a graph based on all individuals in the trio information
(ideally population registers) and neighbourhood graphs. In short, we
create a pedigree (directed graph) with every individual in the trio
data and copy sections around a proband with all individuals that are
<span class="math inline">\(n\)</span> steps away from the proband in
the graph (This is a neighbourhood graphs of degree n, here called a
family graph).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Identify family members of degree n</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>family_graphs <span class="ot">=</span> <span class="fu">get_family_graphs</span>(<span class="at">pop_graph =</span> graph,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                                  <span class="at">ndegree =</span> <span class="dv">1</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                                  <span class="at">proband_vec =</span> pheno<span class="sc">$</span>id,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                                  <span class="at">fid =</span> <span class="st">&quot;fid&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                                  <span class="at">fam_graph_col =</span> <span class="st">&quot;fam_graph&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>family_graphs <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31 × 2</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;   fid   fam_graph</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;   </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 1 dad   &lt;igraph&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 2 mom   &lt;igraph&gt; </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 3 dad2  &lt;igraph&gt; </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 4 mom2  &lt;igraph&gt; </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; # ℹ 27 more rows</span></span></code></pre></div>
<p>The function <code>get_family_graphs()</code> will return a formatted
tibble. The output will have two columns specified with the arguments,
<code>fid</code> and <code>fam_graph_col</code>. <code>fid</code> is the
ids of the provided probands, who are also the individuals the
neighbourhood (family) graphs are centred on. Note: In the example
above, we have only one family graph for a given proband, however, an
individual may still appear in several family graphs as a relative.
E.g., a parent with two children may appearing in the family graph of
both of their children. <code>fam_graph_col</code> holds the family
graphs and are in the format of igraph. Operations on this level will
not be required for the average user. An igraph object is shown here for
context:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>family_graphs<span class="sc">$</span>fam_graph[[<span class="dv">1</span>]]</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; IGRAPH 969b555 DN-- 8 17 -- </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; + attr: name (v/c), sex (v/n)</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; + edges from 969b555 (vertex names):</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;  [1] dad   -&gt;paunt  dad   -&gt;puncle dad   -&gt;sib    dad   -&gt;pid    dad   -&gt;phs   </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;  [6] pgf   -&gt;dad    pgf   -&gt;paunt  pgf   -&gt;puncle pgm   -&gt;dad    pgm   -&gt;paunt </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; [11] pgm   -&gt;puncle paunt -&gt;dad    paunt -&gt;puncle puncle-&gt;dad    puncle-&gt;paunt </span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; [16] sib   -&gt;pid    pid   -&gt;sib</span></span></code></pre></div>
</div>
<div id="censoring-of-future-events-on-a-family-basis" class="section level3">
<h3>Censoring of future events on a family basis</h3>
<p>The purpose of the genetic liability estimated here is prediction. In
epidemiology (and many other fields) there is an emphasis on ensuring
future events are not used to base predictions on. Hence, we need to
ensure that, within a family, no events that happen after the end of
follow up of the proband is used to estimate the genetic liability of
the proband. In real world analysis, the end of follow up can be due to
the proband being diagnosed or any censoring event, such as end of
register follow up, emigration, or death. The function
<code>familywise_censoring()</code> offers a way to censor future events
on a family basis, by censoring all events that happen after the end of
follow up of the proband (<code>indiv_eof</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># calculate family specific thresholds</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>info <span class="ot">=</span> <span class="fu">familywise_censoring</span>(</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">family_graphs =</span> family_graphs,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">tbl =</span> pheno,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">start =</span> <span class="st">&quot;fdato&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">end =</span> <span class="st">&quot;indiv_eof&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">event =</span> <span class="st">&quot;adhd&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="at">merge_by =</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;pid&quot;</span>)))</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">paged_table</span>(info)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["fid"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pid"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sex"],"name":[3],"type":["int"],"align":["right"]},{"label":["fdato"],"name":[4],"type":["date"],"align":["right"]},{"label":["birth_year"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["adhd"],"name":[6],"type":["date"],"align":["right"]},{"label":["indiv_eof"],"name":[7],"type":["date"],"align":["right"]},{"label":["status"],"name":[8],"type":["int"],"align":["right"]},{"label":["aod"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"dad","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"dad","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153"},{"1":"dad","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515"},{"1":"dad","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074"},{"1":"dad","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535"},{"1":"dad","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208"},{"1":"dad","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339"},{"1":"dad","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847"},{"1":"mom","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"mom","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"16.010951"},{"1":"mom","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"56.629706"},{"1":"mom","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"53.095140"},{"1":"mom","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"39.991786"},{"1":"mom","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"51.060917"},{"1":"mom","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523"},{"1":"dad2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.926762"},{"1":"dad2","2":"pgf2","3":"1","4":"1977-12-11","5":"1977","6":"2005-06-11","7":"2005-06-11","8":"1","9":"27.498973","10":"27.498973"},{"1":"dad2","2":"pgm2","3":"0","4":"1994-11-16","5":"1994","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"16.123203"},{"1":"dad2","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523"},{"1":"mom2","2":"mom2","3":"1","4":"1978-08-17","5":"1978","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"32.372348"},{"1":"mom2","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847"},{"1":"mgf","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"mgf","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"17.155373"},{"1":"mgf","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562"},{"1":"mgf","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574"},{"1":"mgm","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"mgm","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"57.774127"},{"1":"mgm","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562"},{"1":"pgf","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"pgf","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153"},{"1":"pgf","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074"},{"1":"pgf","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535"},{"1":"pgm","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"44.818617"},{"1":"pgm","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515"},{"1":"pgm","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"20.301164"},{"1":"pgm","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113"},{"1":"pgm","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"11.408624"},{"1":"pgf2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2005-06-11","8":"0","9":"NA","10":"5.371663"},{"1":"pgf2","2":"pgf2","3":"1","4":"1977-12-11","5":"1977","6":"2005-06-11","7":"2005-06-11","8":"1","9":"27.498973","10":"27.498973"},{"1":"pgm2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.926762"},{"1":"pgm2","2":"pgm2","3":"0","4":"1994-11-16","5":"1994","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"16.123203"},{"1":"pauntH","2":"pauntH","3":"1","4":"1997-11-05","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.152635"},{"1":"pauntH","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841"},{"1":"paunt","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"paunt","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153"},{"1":"paunt","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515"},{"1":"paunt","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074"},{"1":"paunt","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535"},{"1":"paunt","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841"},{"1":"newpgf","2":"newpgf","3":"1","4":"1976-05-22","5":"1976","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"34.609172"},{"1":"newpgf","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113"},{"1":"hspauntH","2":"hspauntH","3":"0","4":"1998-05-13","5":"1998","6":"2010-09-11","7":"2010-09-11","8":"1","9":"12.331280","10":"12.331280"},{"1":"hspauntH","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991"},{"1":"hspaunt","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"1996-09-03","8":"0","9":"NA","10":"-2.026010"},{"1":"hspaunt","2":"newpgf","3":"1","4":"1976-05-22","5":"1976","6":"<NA>","7":"1996-09-03","8":"0","9":"NA","10":"20.284736"},{"1":"hspaunt","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113"},{"1":"hspaunt","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991"},{"1":"puncle","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"puncle","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153"},{"1":"puncle","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515"},{"1":"puncle","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074"},{"1":"puncle","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535"},{"1":"puncle","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729"},{"1":"puncleW","2":"puncleW","3":"1","4":"1997-09-16","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.289528"},{"1":"puncleW","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729"},{"1":"mauntH","2":"mauntH","3":"0","4":"1995-10-10","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.225188"},{"1":"mauntH","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410"},{"1":"maunt","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"maunt","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"17.155373"},{"1":"maunt","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"57.774127"},{"1":"maunt","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562"},{"1":"maunt","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410"},{"1":"newmgm","2":"newmgm","3":"0","4":"1945-06-17","5":"1945","6":"1970-10-02","7":"1970-10-02","8":"1","9":"25.292266","10":"25.292266"},{"1":"newmgm","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"1970-10-02","8":"0","9":"NA","10":"22.149213"},{"1":"hsmuncle","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2000-04-21","8":"0","9":"NA","10":"6.461328"},{"1":"hsmuncle","2":"newmgm","3":"0","4":"1945-06-17","5":"1945","6":"1970-10-02","7":"1970-10-02","8":"1","9":"25.292266","10":"25.292266"},{"1":"hsmuncle","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574"},{"1":"hsmuncle","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"2000-04-21","8":"0","9":"NA","10":"3.967146"},{"1":"hsmuncleW","2":"hsmuncleW","3":"0","4":"1961-04-17","5":"1961","6":"1972-07-03","7":"1972-07-03","8":"1","9":"11.211499","10":"11.211499"},{"1":"hsmuncleW","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"1972-07-03","8":"0","9":"NA","10":"-23.832991"},{"1":"sib","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"sib","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"sib","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208"},{"1":"sib","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339"},{"1":"pid","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"pid","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368"},{"1":"pid","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208"},{"1":"pid","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339"},{"1":"mhs","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"1991-03-02","8":"0","9":"NA","10":"33.453799"},{"1":"mhs","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"1991-03-02","8":"0","9":"NA","10":"-8.906229"},{"1":"mhs","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523"},{"1":"phs","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528"},{"1":"phs","2":"mom2","3":"1","4":"1978-08-17","5":"1978","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"32.372348"},{"1":"phs","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847"},{"1":"pacousin","2":"pauntH","3":"1","4":"1997-11-05","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.152635"},{"1":"pacousin","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074"},{"1":"pacousin","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841"},{"1":"hspacousin","2":"hspauntH","3":"0","4":"1998-05-13","5":"1998","6":"2010-09-11","7":"1987-09-18","8":"0","9":"NA","10":"-10.650240"},{"1":"hspacousin","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1987-09-18","8":"0","9":"NA","10":"13.774127"},{"1":"hspacousin","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991"},{"1":"pucousin","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535"},{"1":"pucousin","2":"puncleW","3":"1","4":"1997-09-16","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.289528"},{"1":"pucousin","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729"},{"1":"macousin","2":"mauntH","3":"0","4":"1995-10-10","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.225188"},{"1":"macousin","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562"},{"1":"macousin","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410"},{"1":"hsmucousin","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574"},{"1":"hsmucousin","2":"hsmuncleW","3":"0","4":"1961-04-17","5":"1961","6":"1972-07-03","7":"1972-07-03","8":"1","9":"11.211499","10":"11.211499"},{"1":"hsmucousin","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"2006-10-10","8":"1","9":"10.436687","10":"10.436687"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The function <code>familywise_censoring()</code> will return a tibble
with the following additional columns:</p>
<ul>
<li><code>status</code>: Assigned case-control status based on the
family-wise censoring time, i.e. if the event happened after the end of
follow up of the family, the status is set to <code>FALSE</code>
(0).</li>
<li><code>aod</code>: The age of diagnosis, NA for controls.</li>
<li><code>age</code>: The age at the end of the family-wise follow
up.</li>
</ul>
<p>The above information is used to calculate the personalised
thresholds for each individual while also accounting for the fact that
each family may have differing levels of information available to
them.</p>
</div>
<div id="assign-thresholds-to-censored-families" class="section level3">
<h3>Assign thresholds to censored families</h3>
<p>Once the <code>status</code>, <code>aod</code>, and <code>age</code>
are known, we can assign thresholds to each family and their family
members. Notably, this means that if an individual appears in multiple
families, e.g. as a proband and as a relative to a different proband,
that individual may have multiple (potentially different) thresholds
assigned to them. The use of <code>fid</code> and <code>pid</code> helps
ensure that each individual can still be uniquely identified. Due to
data privacy, it is possible to encounter CIPs values that are only
provided at set values, e.g. a CIP value for each whole year by birth
year and sex, such as what is shown in with the <code>CIP</code> object.
However, the observed ages (or age of diagnosis) are typically not
integer values. This means we may need to approximate the CIP values
between the provided values. We offer an XGboost based approach to
interpolate the CIPs between the provided values.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>fam_thrs <span class="ot">=</span> <span class="fu">prepare_thresholds</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="at">.tbl =</span> info,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">CIP =</span> CIP,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">age_col =</span> <span class="st">&quot;age&quot;</span> ,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">lower_equal_upper =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="at">personal_thr =</span> <span class="cn">TRUE</span>, </span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="at">fid_col =</span> <span class="st">&quot;fid&quot;</span>,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="at">personal_id_col =</span> <span class="st">&quot;pid&quot;</span>,</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="at">interpolation =</span> <span class="st">&quot;xgboost&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; Warning in prepare_thresholds(.tbl = info, CIP = CIP, age_col = &quot;age&quot;,</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; lower_equal_upper = FALSE, : prepare_thresholds: Some ages are negative. This</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; may be due to the end of follow-up happening before the birth of an individual.</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; Setting their thresholds to be uninformative. Please check the input data.</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">paged_table</span>(fam_thrs)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["fid"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pid"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sex"],"name":[3],"type":["int"],"align":["right"]},{"label":["fdato"],"name":[4],"type":["date"],"align":["right"]},{"label":["birth_year"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["adhd"],"name":[6],"type":["date"],"align":["right"]},{"label":["indiv_eof"],"name":[7],"type":["date"],"align":["right"]},{"label":["status"],"name":[8],"type":["int"],"align":["right"]},{"label":["aod"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["K_i"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["K_pop"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["thr"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["lower"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["upper"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"hsmuncleW","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"1972-07-03","8":"0","9":"NA","10":"-23.832991","11":"4.880407e-05","12":"0.297","13":"3.8964619","14":"-Inf","15":"Inf"},{"1":"hspacousin","2":"hspauntH","3":"0","4":"1998-05-13","5":"1998","6":"2010-09-11","7":"1987-09-18","8":"0","9":"NA","10":"-10.650240","11":"4.880407e-05","12":"0.297","13":"3.8964619","14":"-Inf","15":"Inf"},{"1":"mhs","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"1991-03-02","8":"0","9":"NA","10":"-8.906229","11":"4.880407e-05","12":"0.297","13":"3.8964619","14":"-Inf","15":"Inf"},{"1":"hspaunt","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"1996-09-03","8":"0","9":"NA","10":"-2.026010","11":"4.880407e-05","12":"0.297","13":"3.8964619","14":"-Inf","15":"Inf"},{"1":"dad","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515","11":"9.012269e-03","12":"0.297","13":"2.3651137","14":"2.365114","15":"Inf"},{"1":"pgm","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515","11":"9.012269e-03","12":"0.297","13":"2.3651137","14":"2.365114","15":"Inf"},{"1":"paunt","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515","11":"9.012269e-03","12":"0.297","13":"2.3651137","14":"2.365114","15":"Inf"},{"1":"puncle","2":"pgm","3":"1","4":"1998-09-13","5":"1998","6":"2002-07-12","7":"2002-07-12","8":"1","9":"3.827515","10":"3.827515","11":"9.012269e-03","12":"0.297","13":"2.3651137","14":"2.365114","15":"Inf"},{"1":"hsmuncle","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"2000-04-21","8":"0","9":"NA","10":"3.967146","11":"9.012269e-03","12":"0.297","13":"2.3651137","14":"-Inf","15":"2.3651137"},{"1":"pgf2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2005-06-11","8":"0","9":"NA","10":"5.371663","11":"1.200888e-02","12":"0.297","13":"2.2568449","14":"-Inf","15":"2.2568449"},{"1":"hsmuncle","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2000-04-21","8":"0","9":"NA","10":"6.461328","11":"1.500740e-02","12":"0.297","13":"2.1698950","14":"-Inf","15":"2.1698950"},{"1":"hsmucousin","2":"hsmucousin","3":"0","4":"1996-05-03","5":"1996","6":"2006-10-10","7":"2006-10-10","8":"1","9":"10.436687","10":"10.436687","11":"2.700865e-02","12":"0.297","13":"1.9266979","14":"1.926698","15":"Inf"},{"1":"dad","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"pgf","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"paunt","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"puncle","2":"pgf","3":"1","4":"2000-06-10","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.557153","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"dad2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.926762","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"pgm2","2":"dad2","3":"1","4":"2000-01-27","5":"2000","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"10.926762","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"hsmuncleW","2":"hsmuncleW","3":"0","4":"1961-04-17","5":"1961","6":"1972-07-03","7":"1972-07-03","8":"1","9":"11.211499","10":"11.211499","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"1.880752","15":"Inf"},{"1":"hsmucousin","2":"hsmuncleW","3":"0","4":"1961-04-17","5":"1961","6":"1972-07-03","7":"1972-07-03","8":"1","9":"11.211499","10":"11.211499","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"1.880752","15":"Inf"},{"1":"pgm","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"11.408624","11":"3.000283e-02","12":"0.297","13":"1.8807520","14":"-Inf","15":"1.8807520"},{"1":"hspauntH","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991","11":"3.300472e-02","12":"0.297","13":"1.8383595","14":"1.838360","15":"Inf"},{"1":"hspaunt","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991","11":"3.300472e-02","12":"0.297","13":"1.8383595","14":"1.838360","15":"Inf"},{"1":"hspacousin","2":"hspacousin","3":"1","4":"1975-11-18","5":"1975","6":"1987-09-18","7":"1987-09-18","8":"1","9":"11.832991","10":"11.832991","11":"3.300472e-02","12":"0.297","13":"1.8383595","14":"1.838360","15":"Inf"},{"1":"hspauntH","2":"hspauntH","3":"0","4":"1998-05-13","5":"1998","6":"2010-09-11","7":"2010-09-11","8":"1","9":"12.331280","10":"12.331280","11":"3.300472e-02","12":"0.297","13":"1.8383595","14":"1.838360","15":"Inf"},{"1":"pauntH","2":"pauntH","3":"1","4":"1997-11-05","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.152635","11":"3.599665e-02","12":"0.297","13":"1.7991604","14":"-Inf","15":"1.7991604"},{"1":"pacousin","2":"pauntH","3":"1","4":"1997-11-05","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.152635","11":"3.599665e-02","12":"0.297","13":"1.7991604","14":"-Inf","15":"1.7991604"},{"1":"puncleW","2":"puncleW","3":"1","4":"1997-09-16","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.289528","11":"3.599665e-02","12":"0.297","13":"1.7991604","14":"-Inf","15":"1.7991604"},{"1":"pucousin","2":"puncleW","3":"1","4":"1997-09-16","5":"1997","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"13.289528","11":"3.599665e-02","12":"0.297","13":"1.7991604","14":"-Inf","15":"1.7991604"},{"1":"hspacousin","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1987-09-18","8":"0","9":"NA","10":"13.774127","11":"3.899796e-02","12":"0.297","13":"1.7624345","14":"-Inf","15":"1.7624345"},{"1":"mauntH","2":"mauntH","3":"0","4":"1995-10-10","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.225188","11":"4.200790e-02","12":"0.297","13":"1.7278462","14":"-Inf","15":"1.7278462"},{"1":"macousin","2":"mauntH","3":"0","4":"1995-10-10","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.225188","11":"4.200790e-02","12":"0.297","13":"1.7278462","14":"-Inf","15":"1.7278462"},{"1":"puncle","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"puncleW","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"pucousin","2":"pucousin","3":"1","4":"1995-03-01","5":"1995","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"15.835729","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"mom","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"16.010951","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"dad2","2":"pgm2","3":"0","4":"1994-11-16","5":"1994","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"16.123203","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"pgm2","2":"pgm2","3":"0","4":"1994-11-16","5":"1994","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"16.123203","11":"4.499768e-02","12":"0.297","13":"1.6954222","14":"-Inf","15":"1.6954222"},{"1":"mgf","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"17.155373","11":"4.799923e-02","12":"0.297","13":"1.6645706","14":"-Inf","15":"1.6645706"},{"1":"maunt","2":"mgf","3":"1","4":"1993-11-04","5":"1993","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"17.155373","11":"4.799923e-02","12":"0.297","13":"1.6645706","14":"-Inf","15":"1.6645706"},{"1":"dad","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"pgf","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"paunt","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"puncle","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"pucousin","2":"puncle","3":"0","4":"1991-02-13","5":"1991","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"19.879535","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"hspaunt","2":"newpgf","3":"1","4":"1976-05-22","5":"1976","6":"<NA>","7":"1996-09-03","8":"0","9":"NA","10":"20.284736","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"pgm","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"20.301164","11":"5.699626e-02","12":"0.297","13":"1.5804995","14":"-Inf","15":"1.5804995"},{"1":"newmgm","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"1970-10-02","8":"0","9":"NA","10":"22.149213","11":"6.300569e-02","12":"0.297","13":"1.5300216","14":"-Inf","15":"1.5300216"},{"1":"pgm","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113","11":"6.600075e-02","12":"0.297","13":"1.5062559","14":"1.506256","15":"Inf"},{"1":"newpgf","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113","11":"6.600075e-02","12":"0.297","13":"1.5062559","14":"1.506256","15":"Inf"},{"1":"hspaunt","2":"hspaunt","3":"0","4":"1973-12-09","5":"1973","6":"1996-09-03","7":"1996-09-03","8":"1","9":"22.735113","10":"22.735113","11":"6.600075e-02","12":"0.297","13":"1.5062559","14":"1.506256","15":"Inf"},{"1":"dad","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847","11":"6.900066e-02","12":"0.297","13":"1.4832751","14":"-Inf","15":"1.4832751"},{"1":"mom2","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847","11":"6.900066e-02","12":"0.297","13":"1.4832751","14":"-Inf","15":"1.4832751"},{"1":"phs","2":"phs","3":"0","4":"1987-06-01","5":"1987","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"23.583847","11":"6.900066e-02","12":"0.297","13":"1.4832751","14":"-Inf","15":"1.4832751"},{"1":"newmgm","2":"newmgm","3":"0","4":"1945-06-17","5":"1945","6":"1970-10-02","7":"1970-10-02","8":"1","9":"25.292266","10":"25.292266","11":"7.200011e-02","12":"0.297","13":"1.4610555","14":"1.461055","15":"Inf"},{"1":"hsmuncle","2":"newmgm","3":"0","4":"1945-06-17","5":"1945","6":"1970-10-02","7":"1970-10-02","8":"1","9":"25.292266","10":"25.292266","11":"7.200011e-02","12":"0.297","13":"1.4610555","14":"1.461055","15":"Inf"},{"1":"pauntH","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841","11":"7.799947e-02","12":"0.297","13":"1.4186573","14":"-Inf","15":"1.4186573"},{"1":"paunt","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841","11":"7.799947e-02","12":"0.297","13":"1.4186573","14":"-Inf","15":"1.4186573"},{"1":"pacousin","2":"pacousin","3":"0","4":"1984-02-23","5":"1984","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"26.852841","11":"7.799947e-02","12":"0.297","13":"1.4186573","14":"-Inf","15":"1.4186573"},{"1":"dad2","2":"pgf2","3":"1","4":"1977-12-11","5":"1977","6":"2005-06-11","7":"2005-06-11","8":"1","9":"27.498973","10":"27.498973","11":"7.799947e-02","12":"0.297","13":"1.4186573","14":"1.418657","15":"Inf"},{"1":"pgf2","2":"pgf2","3":"1","4":"1977-12-11","5":"1977","6":"2005-06-11","7":"2005-06-11","8":"1","9":"27.498973","10":"27.498973","11":"7.799947e-02","12":"0.297","13":"1.4186573","14":"1.418657","15":"Inf"},{"1":"dad","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074","11":"8.400605e-02","12":"0.297","13":"1.3786195","14":"-Inf","15":"1.3786195"},{"1":"pgf","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074","11":"8.400605e-02","12":"0.297","13":"1.3786195","14":"-Inf","15":"1.3786195"},{"1":"paunt","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074","11":"8.400605e-02","12":"0.297","13":"1.3786195","14":"-Inf","15":"1.3786195"},{"1":"puncle","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074","11":"8.400605e-02","12":"0.297","13":"1.3786195","14":"-Inf","15":"1.3786195"},{"1":"pacousin","2":"paunt","3":"0","4":"1982-03-24","5":"1982","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"28.772074","11":"8.400605e-02","12":"0.297","13":"1.3786195","14":"-Inf","15":"1.3786195"},{"1":"mom","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523","11":"9.300523e-02","12":"0.297","13":"1.3224737","14":"1.322474","15":"Inf"},{"1":"dad2","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523","11":"9.300523e-02","12":"0.297","13":"1.3224737","14":"1.322474","15":"Inf"},{"1":"mhs","2":"mhs","3":"0","4":"1958-11-21","5":"1958","6":"1991-03-02","7":"1991-03-02","8":"1","9":"32.276523","10":"32.276523","11":"9.300523e-02","12":"0.297","13":"1.3224737","14":"1.322474","15":"Inf"},{"1":"mom2","2":"mom2","3":"1","4":"1978-08-17","5":"1978","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"32.372348","11":"9.300523e-02","12":"0.297","13":"1.3224737","14":"-Inf","15":"1.3224737"},{"1":"phs","2":"mom2","3":"1","4":"1978-08-17","5":"1978","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"32.372348","11":"9.300523e-02","12":"0.297","13":"1.3224737","14":"-Inf","15":"1.3224737"},{"1":"mhs","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"1991-03-02","8":"0","9":"NA","10":"33.453799","11":"9.599962e-02","12":"0.297","13":"1.3046876","14":"-Inf","15":"1.3046876"},{"1":"newpgf","2":"newpgf","3":"1","4":"1976-05-22","5":"1976","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"34.609172","11":"1.020009e-01","12":"0.297","13":"1.2702323","14":"-Inf","15":"1.2702323"},{"1":"mom","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"39.991786","11":"1.169997e-01","12":"0.297","13":"1.1901195","14":"-Inf","15":"1.1901195"},{"1":"dad","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208","11":"1.199973e-01","12":"0.297","13":"1.1750005","14":"-Inf","15":"1.1750005"},{"1":"sib","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208","11":"1.199973e-01","12":"0.297","13":"1.1750005","14":"-Inf","15":"1.1750005"},{"1":"pid","2":"sib","3":"1","4":"1969-11-11","5":"1969","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"41.136208","11":"1.199973e-01","12":"0.297","13":"1.1750005","14":"-Inf","15":"1.1750005"},{"1":"pgm","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2002-07-12","8":"0","9":"NA","10":"44.818617","11":"1.319991e-01","12":"0.297","13":"1.1169908","14":"-Inf","15":"1.1169908"},{"1":"mom","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"51.060917","11":"1.500635e-01","12":"0.297","13":"1.0361612","14":"-Inf","15":"1.0361612"},{"1":"mgf","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"hsmuncle","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"hsmucousin","2":"hsmuncle","3":"0","4":"1948-08-08","5":"1948","6":"2000-04-21","7":"2000-04-21","8":"1","9":"51.701574","10":"51.701574","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"mom","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"mgf","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"mgm","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"maunt","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"sib","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"pid","2":"mom","3":"0","4":"1957-09-17","5":"1957","6":"2009-11-08","7":"2009-11-08","8":"1","9":"52.142368","10":"52.142368","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"1.023647","15":"Inf"},{"1":"dad","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"-Inf","15":"1.0236467"},{"1":"sib","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"-Inf","15":"1.0236467"},{"1":"pid","2":"pid","3":"1","4":"1958-10-17","5":"1958","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"52.205339","11":"1.530011e-01","12":"0.297","13":"1.0236467","14":"-Inf","15":"1.0236467"},{"1":"mom","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"53.095140","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"dad","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"pgf","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"paunt","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"puncle","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"sib","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"pid","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"phs","2":"dad","3":"0","4":"1957-09-16","5":"1957","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"53.289528","11":"1.559971e-01","12":"0.297","13":"1.0110466","14":"-Inf","15":"1.0110466"},{"1":"mgf","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562","11":"1.589762e-01","12":"0.297","13":"0.9986744","14":"-Inf","15":"0.9986744"},{"1":"mgm","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562","11":"1.589762e-01","12":"0.297","13":"0.9986744","14":"-Inf","15":"0.9986744"},{"1":"maunt","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562","11":"1.589762e-01","12":"0.297","13":"0.9986744","14":"-Inf","15":"0.9986744"},{"1":"macousin","2":"maunt","3":"0","4":"1956-10-04","5":"1956","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"54.239562","11":"1.589762e-01","12":"0.297","13":"0.9986744","14":"-Inf","15":"0.9986744"},{"1":"mom","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2009-11-08","8":"0","9":"NA","10":"56.629706","11":"1.680464e-01","12":"0.297","13":"0.9619138","14":"-Inf","15":"0.9619138"},{"1":"mgm","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"57.774127","11":"1.709366e-01","12":"0.297","13":"0.9504704","14":"-Inf","15":"0.9504704"},{"1":"maunt","2":"mgm","3":"1","4":"1953-03-23","5":"1953","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"57.774127","11":"1.709366e-01","12":"0.297","13":"0.9504704","14":"-Inf","15":"0.9504704"},{"1":"mauntH","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410","11":"1.829406e-01","12":"0.297","13":"0.9042154","14":"-Inf","15":"0.9042154"},{"1":"maunt","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410","11":"1.829406e-01","12":"0.297","13":"0.9042154","14":"-Inf","15":"0.9042154"},{"1":"macousin","2":"macousin","3":"1","4":"1949-06-16","5":"1949","6":"<NA>","7":"2010-12-31","8":"0","9":"NA","10":"61.541410","11":"1.829406e-01","12":"0.297","13":"0.9042154","14":"-Inf","15":"0.9042154"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note: Currently, it is possible to experience negative ages at the
end of follow up. This is due to the family-wise end of follow up ending
before an individual is born, e.g. proband is diagnosed in their youth,
then has a child later in life. These individuals will get a
non-informative threshold (<span class="math inline">\(-\infty\)</span>
to max of <code>min_CIP_value</code> and the predicted CIP
[<code>K_i</code>]). In other words, these individuals will have no
impact on the estimate.</p>
<p>The function <code>prepare_thresholds()</code> has several options
that are worth pointing out. The first is
<code>lower_equal_upper</code>, which is used to determine if the
<code>upper</code> and <code>lower</code> thresholds should be the same
for cases or not. This may be useful if the CIP values are considered
very accurate, as it may lead to more accurate genetic liability
estimates. The second is <code>personal_thr</code>, which specifies if
thresholds should be based on <code>K_i</code> or <code>K_pop</code>.
Basing the thresholds on <code>K_i</code> yields personalised thresholds
that are based on the stratification of the CIPs. With the argument
<code>Kpop</code>, it is possible to determine how the
<code>K_pop</code> values are calculated. The current default option for
<code>Kpop</code> is <code>&quot;useMax</code>, which calculates
<code>K_pop</code> as the maximum within each strata provided in the
CIPs. Alternatively, a tibble can be provided with the <code>Kpop</code>
argument, which shares columns with <code>.tbl</code>, e.g. sex, such
that user-specific <code>K_pop</code> values can be specified.</p>
<p>The function <code>prepare_thresholds()</code> will return a tibble
with the following additional columns:</p>
<ul>
<li><code>K_i</code>: The CIP value for the individual. <code>K_i</code>
is predicted if interpolation is used.</li>
<li><code>K_pop</code>: The population prevalence. Currently calculated
as the maximum CIP value within the CIP stratum an individual belongs
to, e.g. for a male born in <span class="math inline">\(2000\)</span>,
<code>K_pop</code> is the maximum CIP value observed among males born in
the year <span class="math inline">\(2000\)</span>. Alternatively,
acquired user-specified values through the <code>Kpop</code>
argument.</li>
<li><code>thr</code>: The liability threshold used to determine
case-control status. <code>thr</code> is used to determine the upper and
lower thresholds of an individual.</li>
<li><code>lower</code>: lower threshold of an individual.</li>
<li><code>upper</code>: upper threshold of an individual.</li>
</ul>
<p>If the mixture model is not used to calculate the genetic liability,
only <code>lower</code> and <code>upper</code> are needed.</p>
</div>
<div id="assign-thresholds-to-family-graphs" class="section level3">
<h3>Assign thresholds to family graphs</h3>
<p>The function <code>estimate_liability()</code> can use the family
graphs to calculate all necessary values for the genetic liability, if
the thresholds are stored as attributes in the family graphs. We can
attach the thresholds from <code>fam_thrs</code> to
<code>family_graphs</code> with the function
<code>familywise_attach_attributes()</code>. The function merges on the
<code>fid</code> column and attaches any columns in
<code>fam_attr</code> that are specified in <code>cols_to_attach</code>.
Since the purpose of the genetic liability we are estimating is
prediction, we do not wish to use the information from the proband. We
mask the proband’s information by setting the <code>upper</code> and
<code>lower</code> values to <span class="math inline">\(\infty\)</span>
and <span class="math inline">\(-\infty\)</span> (non-informative
values) with the argument <code>censor_proband_thrs = TRUE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># attach family specific thresholds</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>ltfgrs_input <span class="ot">=</span> <span class="fu">familywise_attach_attributes</span>(<span class="at">family_graphs =</span> family_graphs,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                                            <span class="at">fam_attr =</span> fam_thrs,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>                                            <span class="at">fam_graph_col =</span> <span class="st">&quot;fam_graph&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>                                            <span class="at">attached_fam_graph_col =</span> <span class="st">&quot;masked_fam_graph&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>                                            <span class="at">cols_to_attach =</span> <span class="fu">c</span>(<span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>),</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>                                            <span class="at">censor_proband_thrs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>ltfgrs_input <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31 × 2</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;   fid   masked_fam_graph</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;          </span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; 1 dad   &lt;igraph&gt;        </span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; 2 mom   &lt;igraph&gt;        </span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; 3 dad2  &lt;igraph&gt;        </span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; 4 mom2  &lt;igraph&gt;        </span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; # ℹ 27 more rows</span></span></code></pre></div>
<p>The format is similar to the one used in
<code>get_family_graphs()</code>. It is worth noting that the arguement
<code>censor_proband_thrs</code> is only required if the purpose of the
resulting genetic liability is prediction.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>ltfgrs_input<span class="sc">$</span>masked_fam_graph[[<span class="dv">1</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; IGRAPH 969b555 DN-- 8 17 -- </span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; + attr: name (v/c), sex (v/n), lower (v/n), upper (v/n)</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; + edges from 969b555 (vertex names):</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;  [1] dad   -&gt;paunt  dad   -&gt;puncle dad   -&gt;sib    dad   -&gt;pid    dad   -&gt;phs   </span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt;  [6] pgf   -&gt;dad    pgf   -&gt;paunt  pgf   -&gt;puncle pgm   -&gt;dad    pgm   -&gt;paunt </span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; [11] pgm   -&gt;puncle paunt -&gt;dad    paunt -&gt;puncle puncle-&gt;dad    puncle-&gt;paunt </span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; [16] sib   -&gt;pid    pid   -&gt;sib</span></span></code></pre></div>
<p>The second row of the igraph (starting with “+attr:”) shows the
attributes that are available to each node in the graph.</p>
</div>
</div>
<div id="estimate-the-genetic-liability" class="section level2">
<h2>Estimate the genetic liability</h2>
<p>The function <code>estimate_liability()</code> is used to estimate
the genetic liability. The function accepts two types of input, here we
will only focus on the graph-based input generated above. The
graph-based input offer the best flexibility and scalability. The
function has two arguments that are worth pointing out.</p>
<p>The first is <code>method</code>, which specifies the method used to
estimate the genetic liability. Currently, two methods are supported.
The first is a Gibbs sampler that samples from a truncated multivariate
normal distribution, <code>method = &quot;Gibbs&quot;</code>. The second is an
iterative pearson-aitken approach, <code>method = &quot;PA&quot;</code>. Generally
speaking, the Pearson-Aitken approach is faster.</p>
<p>The second argument is <code>useMixture</code>, which specifies
whether to use the mixture model or not. The mixture model is currently
only supported with <code>method = &quot;PA&quot;</code>. The mixture model
considers the genetic liability of controls as a mixture of the
truncated normal for cases and controls, rather than just the
distribution of controls. This accounts for the possibility that some
controls are undiagnosed cases and accounts for it in the genetic
liability estimate.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>ltfgrs_pa <span class="ot">=</span> <span class="fu">estimate_liability</span>(<span class="at">family_graphs =</span> ltfgrs_input <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">pid =</span> fid),</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>                               <span class="at">h2 =</span> h2, </span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>                               <span class="at">fid =</span> <span class="st">&quot;fid&quot;</span>,</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>                               <span class="at">pid =</span> <span class="st">&quot;pid&quot;</span>,</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                               <span class="at">family_graphs_col =</span> <span class="st">&quot;masked_fam_graph&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">&quot;PA&quot;</span>, <span class="co"># &lt;- METHOD</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>                               <span class="at">useMixture =</span> F)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; The number of workers is 1</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="fu">paged_table</span>(ltfgrs_pa)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["fid"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pid"],"name":[2],"type":["chr"],"align":["left"]},{"label":["est"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["var"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"dad","2":"dad","3":"0.383671139","4":"0.3863121"},{"1":"mom","2":"mom","3":"0.158670485","4":"0.3722131"},{"1":"dad2","2":"dad2","3":"0.796746819","4":"0.3939615"},{"1":"mom2","2":"mom2","3":"-0.035657750","4":"0.4855060"},{"1":"mgf","2":"mgf","3":"0.606875874","4":"0.3944024"},{"1":"mgm","2":"mgm","3":"0.298117633","4":"0.4340005"},{"1":"pgf","2":"pgf","3":"-0.125521728","4":"0.4553928"},{"1":"pgm","2":"pgm","3":"0.362981259","4":"0.4110707"},{"1":"pgf2","2":"pgf2","3":"-0.007908431","4":"0.4954754"},{"1":"pgm2","2":"pgm2","3":"-0.017538008","4":"0.4914463"},{"1":"pauntH","2":"pauntH","3":"-0.039544933","4":"0.4844110"},{"1":"paunt","2":"paunt","3":"0.462008711","4":"0.3999582"},{"1":"newpgf","2":"newpgf","3":"0.485999777","4":"0.4468142"},{"1":"hspauntH","2":"hspauntH","3":"0.557712796","4":"0.4452756"},{"1":"hspaunt","2":"hspaunt","3":"0.515849203","4":"0.4312229"},{"1":"puncle","2":"puncle","3":"0.464953690","4":"0.4015983"},{"1":"puncleW","2":"puncleW","3":"-0.024812206","4":"0.4888676"},{"1":"mauntH","2":"mauntH","3":"-0.081106503","4":"0.4750873"},{"1":"maunt","2":"maunt","3":"0.177572067","4":"0.4078629"},{"1":"newmgm","2":"newmgm","3":"-0.033020129","4":"0.4862793"},{"1":"hsmuncle","2":"hsmuncle","3":"0.458340290","4":"0.4389008"},{"1":"hsmuncleW","2":"hsmuncleW","3":"0.000000000","4":"0.5000000"},{"1":"sib","2":"sib","3":"0.243971941","4":"0.4161129"},{"1":"pid","2":"pid","3":"0.256100568","4":"0.4174217"},{"1":"mhs","2":"mhs","3":"-0.047103297","4":"0.4824175"},{"1":"phs","2":"phs","3":"-0.116745460","4":"0.4597927"},{"1":"pacousin","2":"pacousin","3":"-0.062602325","4":"0.4740753"},{"1":"hspacousin","2":"hspacousin","3":"-0.021959800","4":"0.4898421"},{"1":"pucousin","2":"pucousin","3":"-0.050837960","4":"0.4774512"},{"1":"macousin","2":"macousin","3":"-0.095422212","4":"0.4661757"},{"1":"hsmucousin","2":"hsmucousin","3":"0.953033747","4":"0.3948750"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>When using <code>method = &quot;PA&quot;</code>, an iterative conditioning is
performed, which means the resulting estimate and uncertainty of the
estimate is the expected mean value and variance of the last iteration,
which is the proband’s genetic liability. This is highlighted by the use
of <code>var</code> in the output.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>ltfgrs_gibbs <span class="ot">=</span> <span class="fu">estimate_liability</span>(<span class="at">family_graphs =</span> ltfgrs_input <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">pid =</span> fid), </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>                                  <span class="at">h2 =</span> h2,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>                                  <span class="at">fid =</span> <span class="st">&quot;fid&quot;</span>,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>                                  <span class="at">pid =</span> <span class="st">&quot;pid&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>                                  <span class="at">family_graphs_col =</span> <span class="st">&quot;masked_fam_graph&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>                                  <span class="at">method =</span> <span class="st">&quot;Gibbs&quot;</span>, <span class="co"># &lt;- METHOD</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>                                  <span class="at">useMixture =</span> F)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; The number of workers is 1</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">paged_table</span>(ltfgrs_gibbs)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["fid"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pid"],"name":[2],"type":["chr"],"align":["left"]},{"label":["genetic_est"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["genetic_se"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"dad","2":"dad","3":"0.3650388992","4":"0.003362732"},{"1":"mom","2":"mom","3":"0.1550972873","4":"0.003486621"},{"1":"dad2","2":"dad2","3":"0.7989979045","4":"0.003402940"},{"1":"mom2","2":"mom2","3":"-0.0375150699","4":"0.004057836"},{"1":"mgf","2":"mgf","3":"0.6019037632","4":"0.003192634"},{"1":"mgm","2":"mgm","3":"0.2969476137","4":"0.003508060"},{"1":"pgf","2":"pgf","3":"-0.1286490074","4":"0.003566619"},{"1":"pgm","2":"pgm","3":"0.3687728691","4":"0.003506104"},{"1":"pgf2","2":"pgf2","3":"0.0005988786","4":"0.004067875"},{"1":"pgm2","2":"pgm2","3":"-0.0237733126","4":"0.003835496"},{"1":"pauntH","2":"pauntH","3":"-0.0425499840","4":"0.003892056"},{"1":"paunt","2":"paunt","3":"0.4525504594","4":"0.003527204"},{"1":"newpgf","2":"newpgf","3":"0.4879485201","4":"0.003416620"},{"1":"hspauntH","2":"hspauntH","3":"0.5576357515","4":"0.003503856"},{"1":"hspaunt","2":"hspaunt","3":"0.5170107496","4":"0.003575221"},{"1":"puncle","2":"puncle","3":"0.4563706664","4":"0.003554809"},{"1":"puncleW","2":"puncleW","3":"-0.0207237632","4":"0.003748630"},{"1":"mauntH","2":"mauntH","3":"-0.0802206718","4":"0.003580215"},{"1":"maunt","2":"maunt","3":"0.1712376312","4":"0.003680701"},{"1":"newmgm","2":"newmgm","3":"-0.0286191814","4":"0.003672843"},{"1":"hsmuncle","2":"hsmuncle","3":"0.4569302042","4":"0.003758116"},{"1":"hsmuncleW","2":"hsmuncleW","3":"-0.0020693727","4":"0.003859301"},{"1":"sib","2":"sib","3":"0.2344021139","4":"0.003455443"},{"1":"pid","2":"pid","3":"0.2512284462","4":"0.003411256"},{"1":"mhs","2":"mhs","3":"-0.0474017024","4":"0.004169940"},{"1":"phs","2":"phs","3":"-0.1208455119","4":"0.004148808"},{"1":"pacousin","2":"pacousin","3":"-0.0565058266","4":"0.004076571"},{"1":"hspacousin","2":"hspacousin","3":"-0.0184645057","4":"0.004187886"},{"1":"pucousin","2":"pucousin","3":"-0.0517440093","4":"0.003737932"},{"1":"macousin","2":"macousin","3":"-0.0934198996","4":"0.003955319"},{"1":"hsmucousin","2":"hsmucousin","3":"0.9530909290","4":"0.003317780"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>When using <code>method = Gibbs</code>, samples are drawn from a
truncated multivariate normal distribution until the convergence
criteria is met. The output is the mean of genetic liability and the
uncertainty is the standard error of the mean. The standard error is
denoted with the <code>se</code> in the column name. Noteably, the
uncertainties with the Gibbs and PA methods are different and should not
be directly compared.</p>
<div id="parallelisation" class="section level3">
<h3>Parallelisation</h3>
<p>The function <code>estimate_liability()</code> is able to use the
<code>future</code> package to parallelise the estimation of the genetic
liability. This is done by setting a suitable <code>plan</code> with the
future backend. A plan suitable for most needs is
<code>plan(multisession, workers = NCORES)</code>, which means that the
function will run in parallel on the local PC utilising
<code>NCORES</code>-cores. Other parallelisation options exist, but they
are all handled by the future suit of packages.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
